<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-121414052-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-121414052-1');
</script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Spring JDBC</title>
  <meta name="description" content="">

  <!-- CSS files -->
  <link rel="stylesheet" href="http://localhost:4000/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://localhost:4000/css/main.css">

  <link rel="canonical" href="http://localhost:4000/spring/2018/07/23/Spring-JDBC.html">
  <link rel="alternate" type="application/rss+xml" title="Ducku Salon" href="http://localhost:4000/feed.xml" />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.png">
</head>

<body>
  <script id="dsq-count-scr" src="//https-youduk-github-io.disqus.com/count.js" async></script>
  <div class="row">
    <div class="col s12 m12">
      <div class="table cover">
        
<div class="cover-card table-cell table-middle">
  
  <img src="http://localhost:4000/img/authorLogo.jpeg" alt="" class="avatar">
  
  <a href="http://localhost:4000/" class="author_name">Ducku Salon</a>
  <span class="author_job">portfolio &amp; Tech blog</span>
  <span class="author_bio mbm">Dreams are not dreamt, they are commplished.</span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="http://localhost:4000/">home</a>
      </li>
       
      <li class="nav-item">
        <a href="http://localhost:4000/archive/">Archive</a>
      </li>
            
      <li class="nav-item">
        <a href="http://localhost:4000/categories/">Categories</a>
      </li>
          
      <li class="nav-item">
        <a href="http://localhost:4000/resume/">Resume</a>
      </li>
          
      <li class="nav-item">
        <a href="http://localhost:4000/tags/">Tags</a>
      </li>
                                                                           
    </ul>
  </nav>
  <script type="text/javascript">
  // based on https://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
</script>
<div class="social-links">
  <ul>
    
      <li>
      <script>gen_mail_to_link('rnejrl123456@gmail.com', 'Hello from website');</script>
      </li>
    
    
    <li><a href="https://facebook.com/originducku" class="social-link-item" target="_blank"><i class="fa fa-fw fa-facebook"></i></a></li>
    
    <li><a href="https://linkedin.com/in/youduk-han-2bbb94108" class="social-link-item" target="_blank"><i class="fa fa-fw fa-linkedin"></i></a></li>
    
    
    
    
    <li><a href="https://github.com/Youduk" class="social-link-item" target="_blank"><i class="fa fa-fw fa-github"></i></a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m12">
      <div class="post-listing">
        <div class="post-container">
<a class="btn" href="http://localhost:4000/">
  Home
</a>

<div class="post-image-feature">
  <img class="feature-image" src="http://localhost:4000/img/spring.png" alt="Spring JDBC feature image">

  
</div>
<!-- /.image-wrap -->



<div id="post">
  <header class="post-header">
    <h1 title="Spring JDBC">Spring JDBC</h1>
    <span class="post-meta">
      <span class="post-date">
        23 JUL 2018
      </span>
      •
      <span class="read-time" title="Estimated read time">
  
  
    30 mins read
  
</span>

    </span>

  </header>

  <article class="post-content">
    <h1 id="1-spring-jdbc-소개">1) Spring JDBC 소개</h1>

<p><strong>들어가기 전에</strong></p>

<p>JDBC를 이용해서 프로그래밍을 하게 되면 반복적인 코드가 많이 발생합니다.</p>

<p>이러한 반복적인 코드는 개발자의 생산성을 떨어트리는 주된 원인이 됩니다.</p>

<p>이러한 문제를 해결하기 위해 등장한 것이 Spring JDBC입니다.</p>

<p>이번 시간엔 Spring JDBC에 대해 알아보도록 하겠습니다.</p>

<hr>

<p><strong>학습 목표</strong></p>

<ol>
  <li>Spring JDBC에 대한 개념을 이해합니다.</li>
  <li>Spring JDBC의 핵심 클래스와 인터페이스에 대해 이해합니다.</li>
</ol>

<hr>

<p><strong>핵심 개념</strong></p>

<ul>
  <li>JdbcTemplate</li>
  <li>RowMapper
    <ul>
      <li>한 행에는 여러 가지 컬럼이 존재한다. 해당 컬럼들을 원하는 객체에 맵핑을 해줘야 할 필요가 있는데, 이 때 사용하는 객체</li>
    </ul>
  </li>
</ul>

<p><strong>Spring JDBC 패키지</strong></p>

<ul>
  <li>org.springframework.jdbc.core
    <ul>
      <li>jdbc template 클래스와 jdbc template의 다양한 콜백 인터페이스를 포함하고 있다. 추가로 여러가지 관련 클래스를 포함하고 있다.</li>
    </ul>
  </li>
  <li>org.springframework.jdbc.datasource
    <ul>
      <li>데이터소스에 접근을 쉽게 하는 유틸리티 클래스와 자바EE 컨테이너 외부에 수정되지않고 운영되는 JDBC 코드와 테스트에서 사용할 수 있는 여러가지 간단한 데이터소스 구현체를 포함하고 있다.</li>
    </ul>
  </li>
  <li>org.springframework.jdbc.object
    <ul>
      <li>RDBMS의 조회, 갱신, 저장 프로시저를 스레드 세이프하고 재사용 가능한 객체로 나타내는 클래스를 포함한다.</li>
    </ul>
  </li>
  <li>org.springframework.jdbc.support
    <ul>
      <li>SQL Exception 변환기능와 약간의 유틸리티 클래스를 제공하고 있다.</li>
    </ul>
  </li>
</ul>

<p><strong>JDBC Template</strong></p>

<ul>
  <li>org.springframework.jdbc.core에서 가장 중요한 클래스입니다.</li>
  <li>리소스 생성, 해지를 처리해서 연결을 닫는 것을 잊어 발생하는 문제 등을 피할 수 있도록 합니다.</li>
  <li>스테이먼트(Statement)의 생성과 실행을 처리합니다.</li>
  <li>SQL 조회, 업데이트, 저장 프로시저 호출, ResultSet 반복호출 등을 실행합니다.</li>
  <li>JDBC 예외가 발생할 경우 org.springframework.dao패키지에 정의되어 있는 일반적인 예외로 변환시킵니다.</li>
</ul>

<hr>

<p><img src="/img/SpringJDBC1.png" alt=""></p>

<ul>
  <li>연결 파라미터 정의 : 어떤 데이터베이스에 접속할건지 등에 대한정보</li>
  <li>SQL문 : 스프링 프레임워크가 알아낼 수 없으므로 개발자가 해야한다.</li>
  <li>파라미터 선언과 파라미터 값 제공 : 파라미터가 어떤 값들을 가지고 쿼리문을 수행할지도 스프링이 알 수가 없으므로 개발자가 해야한다.</li>
  <li>이터레이션에 대한 작업 : 흐름 제어는 개발자가 진행해야한다.</li>
</ul>

<p><strong>실습코드</strong></p>

<p><strong>JdbcTemplate select 예제1</strong></p>

<p>열의 수 구하기</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="kt">int</span> <span class="n">rowCount</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplate</span><span class="o">.</span><span class="na">queryForInt</span><span class="o">(</span><span class="s">"select count(*) from t_actor"</span><span class="o">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p><strong>JdbcTemplate select 예제2</strong></p>

<p>변수 바인딩 사용하기</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="kt">int</span> <span class="n">countOfActorsNamedJoe</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplate</span><span class="o">.</span><span class="na">queryForInt</span><span class="o">(</span><span class="s">"select count(*) from t_actor where first_name = ?"</span><span class="o">,</span> <span class="s">"Joe"</span><span class="o">);</span> 
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p><strong>JdbcTemplate select 예제3</strong></p>

<p>String값으로 결과 받기</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="n">String</span> <span class="n">lastName</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplate</span><span class="o">.</span><span class="na">queryForObject</span><span class="o">(</span><span class="s">"select last_name from t_actor where id = ?"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]{</span><span class="mi">1212L</span><span class="o">},</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> 
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p><strong>JdbcTemplate select 예제4</strong></p>

<p>한 건 조회하기</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td>
<td class="rouge-code"><pre><span class="n">Actor</span> <span class="n">actor</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplate</span><span class="o">.</span><span class="na">queryForObject</span><span class="o">(</span>

  <span class="s">"select first_name, last_name from t_actor where id = ?"</span><span class="o">,</span>

  <span class="k">new</span> <span class="n">Object</span><span class="o">[]{</span><span class="mi">1212L</span><span class="o">},</span>

  <span class="k">new</span> <span class="n">RowMapper</span><span class="o">&lt;</span><span class="n">Actor</span><span class="o">&gt;()</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Actor</span> <span class="nf">mapRow</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">rowNum</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>

      <span class="n">Actor</span> <span class="n">actor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Actor</span><span class="o">();</span>

      <span class="n">actor</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"first_name"</span><span class="o">));</span>

      <span class="n">actor</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"last_name"</span><span class="o">));</span>

      <span class="k">return</span> <span class="n">actor</span><span class="o">;</span>

    <span class="o">}</span>

  <span class="o">});</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<ul>
  <li>한 행에는 여러 가지 컬럼이 존재한다. 해당 컬럼들을 원하는 객체에 맵핑을 해줘야 할 필요가 있는데, 이 때 사용하는 객체가 RowMapper이다. RowMapper를 상속받은 이름없는 객체를 이용해서 Row라는 메서드를 오버라이딩하고 있는 것을 볼 수 있다. 한 건의 결과가 ResultSet에 담겨있기 때문에 해당 ResultSet의 값을 Actor에 담아서 리턴을 하고 있다. 이렇게 실행하면 한 행의 데이터를 조회해서 객체에 담아서 리턴을 해줄 수 있다.</li>
</ul>

<p><strong>JdbcTemplate select 예제5</strong></p>

<p>여러 건 조회하기</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
<td class="rouge-code"><pre><span class="n">List</span><span class="o">&lt;</span><span class="n">Actor</span><span class="o">&gt;</span> <span class="n">actors</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplate</span><span class="o">.</span><span class="na">query</span><span class="o">(</span>

  <span class="s">"select first_name, last_name from t_actor"</span><span class="o">,</span>

  <span class="k">new</span> <span class="n">RowMapper</span><span class="o">&lt;</span><span class="n">Actor</span><span class="o">&gt;()</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">Actor</span> <span class="nf">mapRow</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">rowNum</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>

      <span class="n">Actor</span> <span class="n">actor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Actor</span><span class="o">();</span>

      <span class="n">actor</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"first_name"</span><span class="o">));</span>

      <span class="n">actor</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"last_name"</span><span class="o">));</span>

      <span class="k">return</span> <span class="n">actor</span><span class="o">;</span>

    <span class="o">}</span>

  <span class="o">});</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<ul>
  <li>앞의 한 건을 조회할 때랑 다른 점은 .query() 메서드를 사용하고 있는 부분이다.</li>
</ul>

<p><strong>JdbcTemplate select 예제6</strong></p>

<p>중복 코드 제거 (1건 구하기와 여러 건 구하기가 같은 코드에 있을 경우)</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td>
<td class="rouge-code"><pre><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Actor</span><span class="o">&gt;</span> <span class="nf">findAllActors</span><span class="o">()</span> <span class="o">{</span>

  <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplate</span><span class="o">.</span><span class="na">query</span><span class="o">(</span> <span class="s">"select first_name, last_name from t_actor"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ActorMapper</span><span class="o">());</span>

<span class="o">}</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">ActorMapper</span> <span class="kd">implements</span> <span class="n">RowMapper</span><span class="o">&lt;</span><span class="n">Actor</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="n">Actor</span> <span class="nf">mapRow</span><span class="o">(</span><span class="n">ResultSet</span> <span class="n">rs</span><span class="o">,</span> <span class="kt">int</span> <span class="n">rowNum</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>

    <span class="n">Actor</span> <span class="n">actor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Actor</span><span class="o">();</span>

    <span class="n">actor</span><span class="o">.</span><span class="na">setFirstName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"first_name"</span><span class="o">));</span>

    <span class="n">actor</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"last_name"</span><span class="o">));</span>

    <span class="k">return</span> <span class="n">actor</span><span class="o">;</span>

  <span class="o">}</span>

<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<ul>
  <li>한 건 조회와 여러 건 조회 모두 동일한 RowMapper를 사용하는데 그 부분을 별도의 메서드로 추출함으로써 코드의 중복을 막았다.</li>
</ul>

<p><strong>JdbcTemplate insert 예제</strong></p>

<p>INSERT 하기</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"insert into t_actor (first_name, last_name) values (?, ?)"</span><span class="o">,</span>  <span class="s">"Leonor"</span><span class="o">,</span> <span class="s">"Watling"</span><span class="o">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p><strong>JdbcTemplate update 예제</strong></p>

<p>UPDATE 하기</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"update t_actor set = ? where id = ?"</span><span class="o">,</span>  <span class="s">"Banjo"</span><span class="o">,</span> <span class="mi">5276L</span><span class="o">);</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p><strong>JdbcTemplate delete 예제</strong></p>

<p>DELETE 하기</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="k">this</span><span class="o">.</span><span class="na">jdbcTemplate</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="s">"delete from actor where id = ?"</span><span class="o">,</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">actorId</span><span class="o">));</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p><strong>JdbcTemplate외의 접근방법</strong></p>

<ul>
  <li>NamedParameterJdbcTemplate
    <ul>
      <li>물음표 대신에 이름을 사용해서 바인딩할 수 있도록 해준다. 물음표가 여러 개가 나오면 문자열로 된 이름에 비해 혼란스러울 수 있으므로 이 부분을 해결해준다.</li>
    </ul>
  </li>
  <li>SimpleJdbcTemplate
    <ul>
      <li>JDBC template하고 NamedParameterJdbcTemplate에서 가장 빈번하게 사용되는 작업을 합쳐놓은 객체이다.</li>
    </ul>
  </li>
  <li>SimpleJdbcInsert
    <ul>
      <li>좀 더 쉽게 insert작업을 수행할 수 있게 도와준다.</li>
    </ul>
  </li>
</ul>

<hr>

<p><strong>생각해보기</strong></p>

<ol>
  <li>JDBC 프로그래밍이 불편해서 이를 해결하기 위해서 등장한 기술에는 Spring JDBC 외에도 다양한 기술들이 존재합니다. 대표적으로 JPA와 MyBatis가 그러한 기술입니다. 문제를 해결하는 방법이 왜 여러 가지가 존재할끼요?</li>
</ol>

<hr>

<p><strong>참고 자료</strong></p>

<ul>
  <li>
<strong>[참고링크] Data Access</strong><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#jdbc">https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#jdbc</a>
</li>
</ul>

<h1 id="2-spring-jdbc-실습">2) Spring JDBC 실습</h1>

<p><strong>들어가기 전에</strong></p>

<p>이번 시간엔 실습을 통해 Spring JDBC에 대해 알아보도록 하겠습니다.</p>

<hr>

<p><strong>학습 목표</strong></p>

<ol>
  <li>DTO와 DAO에 대한 개념을 이해합니다.</li>
  <li>Spring JDBC를 이용해 DAO를 작성할 수 있습니다.</li>
</ol>

<hr>

<p><strong>핵심 개념</strong></p>

<ul>
  <li>DTO</li>
  <li>DAO</li>
  <li>NamedParameterJdbcTemplate</li>
</ul>

<p><strong>DTO란?</strong></p>

<ul>
  <li>DTO란 Data Transfer Object의 약자입니다.</li>
  <li>계층간 데이터 교환을 위한 자바빈즈입니다.</li>
  <li>여기서의 계층이란 컨트롤러 뷰, 비지니스 계층, 퍼시스턴스 계층을 의미합니다.</li>
  <li>일반적으로 DTO는 로직을 가지고 있지 않고, 순수한 데이터 객체입니다.</li>
  <li>필드와 getter, setter를 가진다. 추가적으로 toString(), equals(), hashCode()등의 Object 메소드를 오버라이딩 할 수 있습니다.</li>
</ul>

<p><strong>DTO의 예</strong></p>

<p>dto를 간단하게 비유한다면, 계층 간의 데이터를 전달하므로 데이터를 들고 다닐 떄 하나씩 들고 다니면 불편하므로 하나의 가방처럼 만들어서 데이터들을 한꺼번에 갖고 다니는 용도라고 생각하면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
<td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ActorDTO</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">firstName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">lastName</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFirstName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">firstName</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getLastName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">lastName</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">// ......</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p><strong>DAO란?</strong></p>

<ul>
  <li>DAO란 Data Access Object의 약자로 데이터를 조회하거나 조작하는 기능을 전담하도록 만든 객체입니다.</li>
  <li>보통 데이터베이스를 조작하는 기능을 전담하는 목적으로 만들어집니다.</li>
  <li>객체 지향은 어떤 객체가 한 가지 일만 정확하게 하는 것을 바란다. 이 DAO 객체는 딱 그 일만 하도록 만들어놓은 객체라고 생각하면 된다.</li>
</ul>

<p><strong>ConnectionPool 이란?</strong></p>

<ul>
  <li>DB연결은 비용이 많이 듭니다. 데이터베이스로부터 정보를 읽고 쓰는 프로그램을 실행해보면 프로그램이 DBMS에 접속하는 시간이 오래 걸리는 것을 볼 수 있다는 뜻이다.</li>
  <li>커넥션 풀은 미리 커넥션을 여러 개 맺어 둡니다.</li>
  <li>커넥션이 필요하면 커넥션 풀에게 빌려서 사용한 후 반납합니다.</li>
  <li>커넥션을 반납하지 않으면 커넥션 풀에서 사용가능한 커넥션이 없어서 프로그램이 늦어지거나 심할 경우에는 장애를 발생시킬 수도 있다.</li>
</ul>

<p><a href="https://www.edwith.org/boostcourse-web/lecture/20661/#"><img src="https://cphinf.pstatic.net/mooc/20180208_14/15180684447693OANG_JPEG/3_8_2_ConnectionPool.jpg?type=w760" alt="img"></a></p>

<ul>
  <li><strong>ConnectionPool</strong></li>
</ul>

<p><strong>DataSource란?</strong></p>

<ul>
  <li>ConnectionPool은 경우에 따라서 여러 개가 사용될 수 있는데, DataSource는 이러한 커넥션 풀을 관리하는 목적으로 사용되는 객체입니다.</li>
  <li>DataSource를 이용해 커넥션을 얻어오고 반납하는 등의 작업을 수행합니다.</li>
</ul>

<p><strong>Spring JDBC를 이용한 DAO작성 실습</strong></p>

<p><a href="https://www.edwith.org/boostcourse-web/lecture/20661/#"><img src="https://cphinf.pstatic.net/mooc/20180208_103/1518068520531pRbvK_PNG/3_8_2_Spring_JDBC__DAO_.png?type=w760" alt="img">
</a></p>

<ul>
  <li>Spring Container인 ApplicationContext는 설정 파일로 ApplicationConfig라는 클래스를 읽어들인다.</li>
  <li>ApplicationConfig에는 ComponentScan 어노테이션이 DAO 클래스를 찾도록 설정할 것이다. 찾은 모든 DAO 클래스는 Spring Container가 관리하게 된다.</li>
  <li>ApplicationContext는 DBConfig 클래스를 import하게 되고 DBConfig 클래스에서는 DataSource와 TransactionManager 객체를 생성한다.</li>
  <li>DAO는 field로 NamedParameterJdbcTemplate과 SimpleJdbcInsert를 가지게 될 것이고 두 개의 객체는 모두 DataSource를 필요로 할 것이다. 두 개의 객체 모두 SQL의 실행을 편리하게 하도록 Spring JDBC에서 제공하는 객체이기 때문에 DB 연결을 위해서 내부적으로 DataSource를 사용하기 때문이다. 이 두 개의 객체는 RoleDao 생성자에서 초기화를 하게 되고 RolaDao 생성자에서 초기화 된 두 개의 객체를 이용해서 RoleDao의 메서드들을 구현하게 된다.</li>
  <li>Spring Jdbc를 사용하는 사용자는 파라미터와 SQL을 가장 많이 신경 써야 된다. SQL은 RoleDaoSqls에 상수로 정의를 해 놓음으로써 나중에 SQL이 변경될 경우에 좀 더 편하게 수정할 수 있도록 하였다.</li>
  <li>한 건의 Role 정보를 저장하고, 전달하기 위한 목적으로 Role DTO가 사용되고 있는 것을 볼 수 있다.</li>
</ul>

<p><strong>실습코드</strong></p>

<p>pom.xml</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre></td>
<td class="rouge-code"><pre><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"https://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"https://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"https://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

	<span class="nt">&lt;groupId&gt;</span>kr.or.connect<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>daoexam<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
	<span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>

	<span class="nt">&lt;name&gt;</span>daoexam<span class="nt">&lt;/name&gt;</span>
	<span class="nt">&lt;url&gt;</span>https://maven.apache.org<span class="nt">&lt;/url&gt;</span>

	<span class="nt">&lt;properties&gt;</span>
		<span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
		<span class="nt">&lt;spring.version&gt;</span>4.3.5.RELEASE<span class="nt">&lt;/spring.version&gt;</span>
	<span class="nt">&lt;/properties&gt;</span>

	<span class="nt">&lt;dependencies&gt;</span>
		<span class="c">&lt;!-- Spring --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-jdbc<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-tx<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- basic data source --&gt;</span>
        <span class="c">&lt;!-- data source도 여러 가지 종류가 존재한다. --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.apache.commons<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>commons-dbcp2<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>2.1.1<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- mysql 사용을 위한 드라이버 --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>5.1.45<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
			<span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
	<span class="nt">&lt;/dependencies&gt;</span>
   	<span class="c">&lt;!--자바 사용을 위한 build 추가--&gt;</span>
	<span class="nt">&lt;build&gt;</span>
		<span class="nt">&lt;plugins&gt;</span>
			<span class="nt">&lt;plugin&gt;</span>
				<span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
				<span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
				<span class="nt">&lt;version&gt;</span>3.6.1<span class="nt">&lt;/version&gt;</span>
				<span class="nt">&lt;configuration&gt;</span>
					<span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
					<span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
				<span class="nt">&lt;/configuration&gt;</span>
			<span class="nt">&lt;/plugin&gt;</span>
		<span class="nt">&lt;/plugins&gt;</span>
	<span class="nt">&lt;/build&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>ApplicationContext는 Spring이 제공해주는 클래스이다. 어떻게 객체를 생성하게 할 지를 결정하는 설정 정보가 필요한데, 이 정보를 담고 있는 부분이 ApplicationConfig이다. ApplicationConfig는 설정 관련 파일이므로 config라는 패키지를 따로 만들어서 관리한다.</p>

<p>ApplicationConfig.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Import</span><span class="o">;</span>

<span class="c1">//설정 정보 파일이라는 것을 나타내기 위해 Configuration 어노테이션 추가</span>
<span class="nd">@Configuration</span>
<span class="c1">//Import 어노테이션을 이용하면 설정 파일을 여러 개로 나눠서 작업할 수가 있다. 이 설정 파일 하나에 모든 설정을 다 넣는 게 아니라 데이터베이스 관련 설정은 따로 배주고 싶은 것.</span>
<span class="nd">@Import</span><span class="o">({</span><span class="n">DBConfig</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationConfig</span> <span class="o">{</span>

<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>DBConfig.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.dbcp2.BasicDataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.EnableTransactionManagement</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="c1">//transaction 때문에 필요한 어노테이션</span>
<span class="nd">@EnableTransactionManagement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DBConfig</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">driverClassName</span> <span class="o">=</span> <span class="s">"com.mysql.jdbc.Driver"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:mysql://localhost:3306/connectdb?useUnicode=true&amp;characterEncoding=utf8"</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="s">"connectuser"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">"connect123!@#"</span><span class="o">;</span>

    <span class="c1">//Spring JDBC를 이용할 때 우리는 DataSource를 통해 DB에 접속하기로 했다. 이렇게 하기 위해서는 DataSource를 생성할 수 있는 클래스가 필요하다. 따라서 우리가 DataSource 객체를 등록을 해야 한다. 이 때 Bean 어노테이션을 사용해서 손쉽게 등록이 가능하다. DataSource객체는 우리가 작성하는 것이 아니고 이미 작성되어 있는 것을 사용한다. Pom.xml에서 DataSource 객체 라이브러리를 추가했으므로 이 라이브러리에 들어있는 객체를 사용하는 것이다. 현재 우리가 작성하는 코드는 이 DataSource 라이브러리를 사용하기 위한 설정이다.</span>
    <span class="c1">//Bean 등록 방법은 메서드 쓰는 방법이랑 유사하게 사용하면 된다. 메서드 이름은 bean 등록할 때 id로 지정하는 이름과 같다.</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//connection을 관리하는 DataSource 객체는 다음과 같은 정보를 알아야 DataSource를 생성할 수 있다.</span>
    	<span class="n">BasicDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="n">driverClassName</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>위 과정까지가 가장 기본적인 과정이 끝난 것이고, 이제 DB에 잘 접속이 되는지 확인을 해야한다.</p>

<h4 id="접속-확인-과정">접속 확인 과정</h4>

<p>DataSourceTest.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">main</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.daoexam.config.ApplicationConfig</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataSourceTest</span> <span class="o">{</span>
	<span class="c1">//실행을 시켜야 하므로 main 메서드 필요</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//등록한 여러 개의 Bean들을 관리할 Spring Container 생성</span>
        <span class="c1">//어노테이션 정보를 읽는 공장을 만들어야 하므로 AnnotationConfigApplicationContext생성</span>
        <span class="c1">//어떤 클래스에서 정보를 읽을지만 생성자의 매개변수로 넘겨주면 된다.</span>
		<span class="n">ApplicationContext</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="c1">//DataSource 객체를 받아온다.</span>
		<span class="n">DataSource</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">DataSource</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="k">try</span> <span class="o">{</span>
            <span class="c1">//Connection 객체를 DataSource를 통해서 얻어낸다.</span>
			<span class="n">conn</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
            <span class="c1">//정상적으로 얻어 왔을 때.</span>
			<span class="k">if</span><span class="o">(</span><span class="n">conn</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"접속 성공^^"</span><span class="o">);</span>
		<span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span><span class="k">finally</span> <span class="o">{</span>
            <span class="c1">//null인데 닫으라고 할 수도 있으니 체크</span>
			<span class="k">if</span><span class="o">(</span><span class="n">conn</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">try</span> <span class="o">{</span>
					<span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="c1">//close() 메서드도 throws되고 있기 떄문에 catch 블럭을 이용해서 예외 처리를 한다.</span>
				<span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>

<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<hr>

<h4 id="select-과정">select 과정</h4>

<p><strong>실습코드</strong></p>

<p>Role이라는 간단한 DTO를 만들어본다.</p>

<p>Role.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">dto</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Role</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">roleId</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getRoleId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">roleId</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRoleId</span><span class="o">(</span><span class="kt">int</span> <span class="n">roleId</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">roleId</span> <span class="o">=</span> <span class="n">roleId</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">description</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDescription</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"Role [roleId="</span> <span class="o">+</span> <span class="n">roleId</span> <span class="o">+</span> <span class="s">", description="</span> <span class="o">+</span> <span class="n">description</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
	<span class="o">}</span>
	
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>DTO는 자신이 가지고 있는 필드를 이용해서 해당 값을 넣거나 꺼내기 때문에 기본적으로 getter, setter메서드가 필요하다. 이 DTO가 가방이고 각 필드가 하나하나의 값이다. 이 가방에 값이 제대로 들어있는지 매번 가방을 뒤지려면 불편하다. 그런데 Object가 가지고 있는 메서드 중에 toString()이라는 메서드가 있으므로 이 메서드를 이용해서 가방 안에 있는 값을 한 번에 확인할 때 유용하다.</p>

<p>sql을 담고 있어야 하는, query문을 담고 있어야 하는 객체를 만든다.</p>

<p>여기 우리가 사용하고자 하는 query를 상수형태로 넣어주면 된다. final을 붙여서 상수로 만들고, 상수 네이밍 관례에 따라서 모두 대문자로 필드 이름을 지정한다.</p>

<p>RoleDaoSqls.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RoleDaoSqls</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">SELECT_ALL</span> <span class="o">=</span> <span class="s">"SELECT role_id, description FROM role order by role_id"</span><span class="o">;</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>위에서 만든 query문을 가진 객체를 가지고 데이터에 접근할 수 있는 객체를 만든다. 이런 객체를 DAO라고 한다고 했다. Role이라는 객체에 대해 데이터를 접근할 수 있는 객체이므로 RoleDao라고 이름 짓는다.</p>

<p>RoleDao.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">RoleDaoSqls</span><span class="o">.*;</span>

<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.dao.EmptyResultDataAccessException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.BeanPropertyRowMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.RowMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.SqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.simple.SimpleJdbcInsert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.daoexam.dto.Role</span><span class="o">;</span>
<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RoleDao</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">NamedParameterJdbcTemplate</span> <span class="n">jdbc</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">SimpleJdbcInsert</span> <span class="n">insertAction</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">RowMapper</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span> <span class="n">rowMapper</span> <span class="o">=</span> <span class="n">BeanPropertyRowMapper</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Role</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

	<span class="kd">public</span> <span class="nf">RoleDao</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">jdbc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NamedParameterJdbcTemplate</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
		<span class="k">this</span><span class="o">.</span><span class="na">insertAction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleJdbcInsert</span><span class="o">(</span><span class="n">dataSource</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withTableName</span><span class="o">(</span><span class="s">"role"</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span> <span class="nf">selectAll</span><span class="o">(){</span>
		<span class="k">return</span> <span class="n">jdbc</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">SELECT_ALL</span><span class="o">,</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyMap</span><span class="o">(),</span> <span class="n">rowMapper</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>이 클래스는 Spring Container가 읽어들여서 사용해야 되는데 Bean을 등록할 수 있는 여러 가지 방법들이 있었다. 그 중 어노테이션을 붙여서 <a href="https://github.com/Autowired" class="user-mention">@Autowired</a>로 읽어내게 하는 방식이 있었는데, 이 때 붙일 수 있는 어노테이션의 종류가 몇 가지 있었다. <code class="highlighter-rouge">@Component, @Service, @Repository, @Controller</code> 와 같은 것들이 있었는데, 지금과 같은 DAO 객체에는 저장소의 역할을 한다는 의미로 <code class="highlighter-rouge">@Repository</code>를 사용한다. DAO가 실제 실행할 때 NamedParameterJdbcTemplate이라던가 SimpleJdbcInsert와 같은 객체들을 이용한다. 이 객체들은 Spring JDBC가 실제 JDBC를 조금 편하게 하기 위해서 이미 구현해 놓은 객체라고 생각하면 된다. 우리가 SelectAll()을 실행해서 select 할 때는 NamedParameterJdbcTemplate 안에 있는 query(), queryForObject()와 같은 메서드가 필요하다. 따라서  NamedParameterJdbcTemplate를 먼저 선언해 줘야한다.</p>

<p>Spring JDBC에서 가장 중요한 객체는 JdbcTemplate이다. 지난 과정에서 사용했던 JdbcTemplate은 바인딩할 때 ?를 사용했었다. 그런데 ?를 사용하게 되면 sql 문자열만 봤을 때는 어떤 값이 매핑되는지 알아보기가 힘든 문제들이 있었다. 그래서 NamedParameterJdbcTemplate이 활용이 되었는데, NamedParameterJdbcTemplate은 이름을 이용해서 바인딩 하거나, 결과 값을 가져올 때 사용할 수 있다. 그래서 여기서는 이 객체를 사용한다.</p>

<p>생성자 부분을 보면 DataSource를 파라미터로 받아들이고 있다. Spring 버전 4.3부터는 ComponentScan으로 객체를 찾았을 때 기본 생성자가 없다면 자동으로 객체를 주입해준다. DBConfig.java에서 Bean어노테이션으로 등록했던 DataSource가 매개변수로 전달이 되게 된다. 이 DataSource 객체를 받아서 NamedParameterJdbcTemplate을 생성하게 되는 것이다.</p>

<p>이제 실제로 우리가 하고자하는 것은 selectAll해서 정보를 가져오는 것이다. 이 selectAll 메서드는 DTO인 Role을 여러 건 가져올 거니까 List로 받아야하고 메서드 이름은 항상 소문자로 시작한다. 두 번째 단어의 첫 글자는 대문자로. 내용을 작성하는데, 복잡한 코드는 NamedParameterJdbcTemplate이 알아서 해준다. NamedParameterJdbcTemplate가 가지고 있는 메서드 중에 query()메서드에 파라미터를 넣고 실행하면 된다. 첫 번째 나오는 파라미터는 실제 쿼리문이다. 이 쿼리문은 RoleDaoSqls에 작성해놨으므로 <strong>static import</strong>를 사용하여 RoleDaoSqls에 선언된 변수를 class 이름없이 바로 변수 이름으로 사용할 수 있게 한다. 두 번째 파라미터에는 비어있는 Map 객체를 하나 선언하면된다. Collections.emptyMap()과 같은 것을 전달하면 된다. 이 객체는 sql문에 바인딩 할 값이 있을 경우에  바인딩 할 값을 전달할 목적으로 상요하고 있는 객체이다. 세 번째 파라미터에는 미리 만들어 놓은 rowMapper를 전달하면 된다. 이 객체는  select 한 건, 한 건의 결과를 DTO에 저장하는 목적으로 사용을 하게 된다. BeanPropertyRowMapper 객체를 이용해서 column의 값을 자동으로 DTO에 담아주게 된다. query() 메서드는 결과가 여러 건이었을 때 내부적으로 반복하면서 DTO를 생성하고, 이 생성한 DTO를 List에다가 담고 이 List를 반환해 준다.</p>

<table>
  <thead>
    <tr>
      <th>DBMS</th>
      <th>JAVA</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>rold_id</td>
      <td>roleId</td>
    </tr>
  </tbody>
</table>

<p>대부분의 DBMS는 대소문자를 구별하기 않기 때문에 DBMS에서는 column 명의 단어와 단어를 구분할 때 ‘_‘를 사용하고, 자바에서는 카멜표기법을 이용해서 단어와 단어가 만날 때 대문자를 사용한다. 이렇게 같은 데이터를 나타내는 이름이 다르면 개발이 힘들 수 있는데, BeanPropertyRowMapper는 DBMS와 Java의 이름의 규칙을 맞춰주는 기능을 갖고 있다.</p>

<p>ApplicationConfig.java 에 추가</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
</pre></td>
<td class="rouge-code"><pre><span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="o">{</span> <span class="s">"kr.or.connect.daoexam.dao"</span> <span class="o">})</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>Bean을 등록하는 방법으로 어노테이션을 이용했으므로 ApplicationConfig에 ComponentScan으로 읽어낼 거라는 표시를 해줘야 한다. 그래야 설정  파일을 읽어낼 때 약속된 어노테이션이 붙어있는 객체들을 찾아내서 작업을 진행한다. basePackages를 지정해서 사용한다. 중괄호를 이용해서 패키지를 여러 개 나열해서 사용할 수도 있다. ComponenetScan을 추가했으므로 자동으로 RoleDao에 Repository가 붙어있는 클래스를 Bean으로 등록해준 것이랑 같은 역할을 하게 된다.</p>

<p>필요한 코드들을 모두 작성했으므로 테스트를 해야한다.</p>

<p>SelectAllTest.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">main</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.daoexam.config.ApplicationConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.daoexam.dao.RoleDao</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.daoexam.dto.Role</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SelectAllTest</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">ApplicationContext</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> 
		
		<span class="n">RoleDao</span> <span class="n">roleDao</span> <span class="o">=</span><span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">RoleDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

		<span class="n">List</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">roleDao</span><span class="o">.</span><span class="na">selectAll</span><span class="o">();</span>
		
		<span class="k">for</span><span class="o">(</span><span class="n">Role</span> <span class="nl">role:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
		<span class="o">}</span>

	<span class="o">}</span>

<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>반복되어 나오는 코드들이다. AnnotationConfigApplicationContext를 생성했고 ApplicationContext에서 getBean()메서드를 사용하여 roleDao 객체를 얻어낸 다음 roleDao가 가지고 있는 selectAll()이라는 메서드를 수행해서 실제 리스트를 받아내는 것이다.</p>

<p>DTO에서 지정한 필드명이 roleId, description과 같은지 잘 확인해봐야한다. 테스트에서는 제대로 작동하지 않아서 찾아보니 DTO에 설정한 필드명에 오타가 있었다.</p>

<hr>

<h4 id="insert-update구현">Insert, Update구현</h4>

<p><strong>실습코드</strong></p>

<p>RoleDaoSqls.java에 추가</p>

<p>필요한 쿼리문을 추가한다. insert는 추가해주지 않아도 된다. (우리가 임의로 값을 넣어서 테스트할 것 이므로)</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td>
<td class="rouge-code"><pre><span class="c1">//여기서 :이후에 나와있는 부분이 값으로 바인딩 될 부분이다.</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">UPDATE</span> <span class="o">=</span> <span class="s">"UPDATE role SET description = :description WHERE ROLE_ID = :roleId"</span><span class="o">;</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>RoleDao.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">RoleDaoSqls</span><span class="o">.*;</span>

<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.dao.EmptyResultDataAccessException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.BeanPropertyRowMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.RowMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.SqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.simple.SimpleJdbcInsert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.daoexam.dto.Role</span><span class="o">;</span>
<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RoleDao</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">NamedParameterJdbcTemplate</span> <span class="n">jdbc</span><span class="o">;</span>
    <span class="c1">//1.SimpleJdbcInsert 선언</span>
	<span class="kd">private</span> <span class="n">SimpleJdbcInsert</span> <span class="n">insertAction</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">RowMapper</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span> <span class="n">rowMapper</span> <span class="o">=</span> <span class="n">BeanPropertyRowMapper</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Role</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

	<span class="kd">public</span> <span class="nf">RoleDao</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">jdbc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NamedParameterJdbcTemplate</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="c1">//2.생성자에서 생성. dataSource를 매개변수로 넘기고 어떤 테이블에 Insert 할 것인지 withTableName메서드를 사용하여 명시한 후 SimpleJdbcInsert를 생성을 하고 변수 insertAction에 할당.</span>
		<span class="k">this</span><span class="o">.</span><span class="na">insertAction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleJdbcInsert</span><span class="o">(</span><span class="n">dataSource</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withTableName</span><span class="o">(</span><span class="s">"role"</span><span class="o">);</span>

	<span class="o">}</span>
	
    <span class="c1">//3.insert 메서드 구현</span>
    <span class="c1">//Insert문 같은 경우에는 Primary key를 자동으로 생성해야 하는 경우도 존재한다. 이럴 때는 생성된 Primary key 값을 다시 읽어오는 부분이 필요하다. 그 떄는 SimpleJdbcInsert객체가 이 일을 수행해주는데 이번 예제에서는 Primary key값을 직접 넣어준다. 다음 파트에서는 Primary key를 자동으로 생성하도록 코드를 변경한다.</span>
    <span class="c1">//role객체를 받아들여서</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">insert</span><span class="o">(</span><span class="n">Role</span> <span class="n">role</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//해당 role 객체에 있는 값을 웹으로 바꿔준다. 이 때 우리가 Role 클래스에서 선언한 roleId를 column명인 rold_id로 알아서 맵 객체를 생성해준다. </span>
		<span class="n">SqlParameterSource</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BeanPropertySqlParameterSource</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
        <span class="c1">//이렇게 생성한 맵 객체를 SimpleJdbcInsert가 가지고 있는 execute()라는 메서드의 파라미터로 전달을 할 경우에 값이 알아서 저장되게 될 것이다.</span>
		<span class="k">return</span> <span class="n">insertAction</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">params</span><span class="o">);</span>
	<span class="o">}</span>

    <span class="c1">//static import를 통해 쿼리문을 담아 놓은 UPDATE 변수를 사용할 수 있게 하고, NamedParameterJdbcTemplate이 가지고 있는 update() 메서드에 첫 번째 파라미터에 sql, 두 번째 파라미터로 맵 객체를 넘겨준다. 이 맵 객체는 sql문에서 :이후에 나왔던 단어들의 값을 채워줄 객체라고 생각하면 된다.</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">update</span><span class="o">(</span><span class="n">Role</span> <span class="n">role</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">SqlParameterSource</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BeanPropertySqlParameterSource</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">jdbc</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">UPDATE</span><span class="o">,</span> <span class="n">params</span><span class="o">);</span>
	<span class="o">}</span>
	
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>이제 코드가 잘 작동이 되는지 테스트해본다.</p>

<p>JDBCTest.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">main</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.daoexam.config.ApplicationConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.daoexam.dao.RoleDao</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.daoexam.dto.Role</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JDBCTest</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//기본적으로 RoleDao까지 얻어오는 부분은 똑같이 실행을 하면 된다.</span>
		<span class="n">ApplicationContext</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

		<span class="n">RoleDao</span> <span class="n">roleDao</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">RoleDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		
        <span class="c1">//위에서 얻어온 roleDao에게 insert 메서드가 잘 적용이 되는지 테스트하면 된다.</span>
        <span class="c1">//insert문을 실행하려면 DTO객체인 Role에 값이 들어있어야한다. 그러므로 Role객체를 생성하고 값을 넣어준다.</span>
		<span class="n">Role</span> <span class="n">role</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Role</span><span class="o">();</span>
		<span class="n">role</span><span class="o">.</span><span class="na">setRoleId</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span>
		<span class="n">role</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">"PROGRAMMER"</span><span class="o">);</span>
		
		<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">roleDao</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">count</span> <span class="o">+</span> <span class="s">"건 입력하였습니다."</span><span class="o">);</span>
			
		<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">roleDao</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">count</span> <span class="o">+</span>  <span class="s">" 건 수정하였습니다."</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<hr>

<h4 id="1건-select하는-메서드와-delete하는-기능-구현">1건 select하는 메서드와 delete하는 기능 구현</h4>

<p><strong>실습코드</strong></p>

<p>RoleDaoSqls.java에 추가</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td>
<td class="rouge-code"><pre><span class="c1">//쿼리문에 *보다는 정확한 Column명을 사용하는 것이 훨씬 명확한 의미전달을 가능하게 해준다.</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">SELECT_BY_ROLE_ID</span> <span class="o">=</span> <span class="s">"SELECT role_id, description FROM role where role_id = :roleId"</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DELETE_BY_ROLE_ID</span> <span class="o">=</span> <span class="s">"DELETE FROM role WHERE role_id = :roleId"</span><span class="o">;</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>RoleDao.java에 추가</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">daoexam</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">RoleDaoSqls</span><span class="o">.*;</span>

<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.dao.EmptyResultDataAccessException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.BeanPropertyRowMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.RowMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.SqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.simple.SimpleJdbcInsert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.daoexam.dto.Role</span><span class="o">;</span>
<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RoleDao</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">NamedParameterJdbcTemplate</span> <span class="n">jdbc</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">SimpleJdbcInsert</span> <span class="n">insertAction</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">RowMapper</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span> <span class="n">rowMapper</span> <span class="o">=</span> <span class="n">BeanPropertyRowMapper</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Role</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

	<span class="kd">public</span> <span class="nf">RoleDao</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">jdbc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NamedParameterJdbcTemplate</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
		<span class="k">this</span><span class="o">.</span><span class="na">insertAction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleJdbcInsert</span><span class="o">(</span><span class="n">dataSource</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withTableName</span><span class="o">(</span><span class="s">"role"</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">deleteById</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
        <span class="c1">//NamedParameterJdbcTemplate이 가지고 있는 update를 실행하면 된다.</span>
		<span class="k">return</span> <span class="n">jdbc</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">DELETE_BY_ROLE_ID</span><span class="o">,</span> <span class="n">params</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="n">Role</span> <span class="nf">selectById</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
            <span class="c1">//1건 select할 때는 queryForObject라는 메서드 이용</span>
			<span class="k">return</span> <span class="n">jdbc</span><span class="o">.</span><span class="na">queryForObject</span><span class="o">(</span><span class="n">SELECT_BY_ROLE_ID</span><span class="o">,</span> <span class="n">params</span><span class="o">,</span> <span class="n">rowMapper</span><span class="o">);</span>	            
		<span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">EmptyResultDataAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span><span class="c1">//조건에 맞는 값이 없을 때 예외 발생</span>
			<span class="c1">//이 부분을 주의해서 사용해야한다.</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>

<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>JDBCTest.java에 추가</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="n">Role</span> <span class="n">resultRole</span> <span class="o">=</span> <span class="n">roleDao</span><span class="o">.</span><span class="na">selectById</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">resultRole</span><span class="o">);</span>
		
<span class="kt">int</span> <span class="n">deleteCount</span> <span class="o">=</span> <span class="n">roleDao</span><span class="o">.</span><span class="na">deleteById</span><span class="o">(</span><span class="mi">500</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">deleteCount</span> <span class="o">+</span> <span class="s">"건 삭제하였습니다."</span><span class="o">);</span>
	
<span class="n">Role</span> <span class="n">resultRole2</span> <span class="o">=</span> <span class="n">roleDao</span><span class="o">.</span><span class="na">selectById</span><span class="o">(</span><span class="mi">500</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">resultRole2</span><span class="o">);</span>
		
</pre></td>
</tr></tbody></table></code></pre></div></div>

<hr>

<p><strong>생각해보기</strong></p>

<ol>
  <li>JdbcTemplate을 이용하지 않고 NamedParameterJdbcTemplate를 이용하여 DAO를 작성한 이유는 무엇이라고 생각하나요?</li>
</ol>

<hr>

<p><strong>참고 자료</strong></p>

<ul>
  <li>
    <p><strong>[참고링크] Data Access Object Pattern</strong><a href="https://www.tutorialspoint.com/design_pattern/data_access_object_pattern.htm">https://www.tutorialspoint.com/design_pattern/data_access_object_pattern.htm</a></p>
  </li>
  <li>
    <p><strong>[참고링크] Using JDBC to Connect to a Database</strong><a href="https://ejbvn.wordpress.com/category/week-2-entity-beans-and-message-driven-beans/day-09-using-jdbc-to-connect-to-a-database/">https://ejbvn.wordpress.com/category/week-2-entity-beans-and-message-driven-beans/day-09-using-jdbc-to-connect-to-a-database/</a></p>
  </li>
</ul>


  </article>
</div>

<!-- <div class="share-buttons">
  <h6>Share on: </h6>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/spring/2018/07/23/Spring-JDBC.html" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/spring/2018/07/23/Spring-JDBC.html" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://localhost:4000/spring/2018/07/23/Spring-JDBC.html" class="google-plus btn" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
    <li>
      <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/spring/2018/07/23/Spring-JDBC.html" class="hacker-news btn" title="Share on Hacker News"><i class="fa fa-hacker-news"></i><span> Hacker News</span></a>
    </li>
    <li>
      <a href="https://www.reddit.com/submit?url=http://localhost:4000/spring/2018/07/23/Spring-JDBC.html" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
    </li>
  </ul>
</div> -->


<div id="disqus_thread"></div>
</div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://https-youduk-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>


        <footer>
  © 2018 Ducku Salon. Powered by <a href="https://jekyllrb.com/">Jekyll</a>, <a href="https://github.com/renyuanz/leonids/">customized with leonids theme</a> <i class="fa fa-heart heart-icon"></i>
</footer>

<!-- Channel Plugin Scripts -->
<script>
  ;window.channelPluginSettings = {
    "pluginKey": "9de17a11-abe2-455f-a49c-1c7da4fa312c"
  };
  (function() {
    var w = window;
    if (w.ChannelIO) {
      return (window.console.error || window.console.log || function(){})('ChannelIO script included twice.');
    }
    var d = window.document;
    var ch = function() {
      ch.c(arguments);
    };
    ch.q = [];
    ch.c = function(args) {
      ch.q.push(args);
    };
    w.ChannelIO = ch;
    function l() {
      if (w.ChannelIOInitialized) {
        return;
      }
      w.ChannelIOInitialized = true;
      var s = document.createElement('script');
      s.type = 'text/javascript';
      s.async = true;
      s.src = 'https://cdn.channel.io/plugin/ch-plugin-web.js';
      s.charset = 'UTF-8';
      var x = document.getElementsByTagName('script')[0];
      x.parentNode.insertBefore(s, x);
    }
    if (document.readyState === 'complete') {
      l();
    } else if (window.attachEvent) {
      window.attachEvent('onload', l);
    } else {
      window.addEventListener('DOMContentLoaded', l, false);
      window.addEventListener('load', l, false);
    }
  })();
</script>
<!-- End Channel Plugin -->        
      </div>
    </div>
  </div>
  <script id="dsq-count-scr" src="//https-youduk-github-io.disqus.com/count.js" async></script>
  <script type="text/javascript" src="http://localhost:4000/js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="http://localhost:4000/js/main.js"></script>


    
</body>

</html>
