<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-121414052-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-121414052-1');
</script>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Layered Architecture 실습</title>
  <meta name="description" content="">

  <!-- CSS files -->
  <link rel="stylesheet" href="http://localhost:4000/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://localhost:4000/css/main.css">

  <link rel="canonical" href="http://localhost:4000/spring/2018/08/25/Layered-Architecture-%E1%84%89%E1%85%B5%E1%86%AF%E1%84%89%E1%85%B3%E1%86%B8.html">
  <link rel="alternate" type="application/rss+xml" title="Ducku Salon" href="http://localhost:4000/feed.xml" />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.png">
</head>

<body>
  <script id="dsq-count-scr" src="//https-youduk-github-io.disqus.com/count.js" async></script>
  <div class="row">
    <div class="col s12 m12">
      <div class="table cover">
        
<div class="cover-card table-cell table-middle">
  
  <img src="http://localhost:4000/img/authorLogo.jpeg" alt="" class="avatar">
  
  <a href="http://localhost:4000/" class="author_name">Ducku Salon</a>
  <span class="author_job">portfolio &amp; Tech blog</span>
  <span class="author_bio mbm">Dreams are not dreamt, they are commplished.</span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="http://localhost:4000/">home</a>
      </li>
       
      <li class="nav-item">
        <a href="http://localhost:4000/archive/">Archive</a>
      </li>
            
      <li class="nav-item">
        <a href="http://localhost:4000/categories/">Categories</a>
      </li>
          
      <li class="nav-item">
        <a href="http://localhost:4000/resume/">Resume</a>
      </li>
          
      <li class="nav-item">
        <a href="http://localhost:4000/tags/">Tags</a>
      </li>
                                                                           
    </ul>
  </nav>
  <script type="text/javascript">
  // based on https://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
</script>
<div class="social-links">
  <ul>
    
      <li>
      <script>gen_mail_to_link('rnejrl123456@gmail.com', 'Hello from website');</script>
      </li>
    
    
    <li><a href="https://facebook.com/originducku" class="social-link-item" target="_blank"><i class="fa fa-fw fa-facebook"></i></a></li>
    
    <li><a href="https://linkedin.com/in/youduk-han-2bbb94108" class="social-link-item" target="_blank"><i class="fa fa-fw fa-linkedin"></i></a></li>
    
    
    
    
    <li><a href="https://github.com/Youduk" class="social-link-item" target="_blank"><i class="fa fa-fw fa-github"></i></a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
  </ul>
</div>

</div>

      </div>
    </div>
    <div class="col s12 m12">
      <div class="post-listing">
        <div class="post-container">
<a class="btn" href="http://localhost:4000/">
  Home
</a>

<div class="post-image-feature">
  <img class="feature-image" src="http://localhost:4000/img/spring.png" alt="Layered Architecture 실습 feature image">

  
</div>
<!-- /.image-wrap -->



<div id="post">
  <header class="post-header">
    <h1 title="Layered Architecture 실습">Layered Architecture 실습</h1>
    <span class="post-meta">
      <span class="post-date">
        25 AUG 2018
      </span>
      •
      <span class="read-time" title="Estimated read time">
  
  
    27 mins read
  
</span>

    </span>

  </header>

  <article class="post-content">
    <h1 id="2-레이어드-아키텍처layered-architecture-실습">2) 레이어드 아키텍처(Layered Architecture) 실습</h1>

<p><strong>들어가기 전에</strong></p>

<p>이번 시간엔 방명록을 Spring 프레임워크를 이용해 만들어 보도록 하겠습니다.</p>

<p>이를 통해 각 레이어별로 어떤 내용들을 작성해야 하는지 알아보고, 완전히 동작하는 웹 어플리케이션을 개발해 봄으로써 Spring 웹 어플리케이션에 대한 이해를 높이는 시간이 될 수 있길 바랍니다.</p>

<hr>

<p><strong>학습 목표</strong></p>

<ol>
  <li>Spring 프레임워크를 이용한 웹 어플리케이션 프로젝트를 구성할 수 있습니다.</li>
  <li>Spring 프레임워크를 이용한 웹 어플리케이션 개발 시 어떤 요소들을 개발해야하는지 이해합니다.</li>
</ol>

<hr>

<p><strong>핵심 개념</strong></p>

<ul>
  <li><a href="https://github.com/Controller" class="user-mention">@Controller</a></li>
  <li><a href="https://github.com/Service" class="user-mention">@Service</a></li>
  <li><a href="https://github.com/Repository" class="user-mention">@Repository</a></li>
  <li><a href="https://github.com/Transactional" class="user-mention">@Transactional</a></li>
</ul>

<p>방명록 만들기 실습</p>

<ul>
  <li>Spring JDBC를 이용한 Dao 작성</li>
  <li>Controller + Service + Dao</li>
  <li>트랜잭션 처리</li>
  <li>Spring MVC에서 폼 값 입력받기</li>
  <li>Spring MVC에서 redirect하기</li>
  <li>Controller에서 jsp에게 전달한 값을 JSTL과 EL을 이용해 출력하기</li>
</ul>

<p>방명록 요구사항 1/6</p>

<ul>
  <li>방명록 정보는 guestbook 테이블에 저장된다.</li>
  <li>id 컬럼은 자동으로 입력된다.</li>
  <li>id, 이름, 내용, 등록일을 저장한다.</li>
</ul>

<p>방명록 요구사항 2/6</p>

<ul>
  <li>https://localhost:8080/guestbook/을 요청하면 자동으로 /guestbook/list로 리다이렉팅 한다.</li>
  <li>방명록이 없으면 건수는 0이 나오고 아래에 방명록을 입력하는 폼이 보여진다.</li>
</ul>

<p>방명록 요구사항 3/6</p>

<ul>
  <li>이름과 내용을 입력하고, 등록 버튼을 누르면 /guestbook/write/URL로 입력한 값을 전달하여 저장한다.</li>
  <li>값이 저장된 이후에는 /guestbook/list로 리다이렉트 된다.</li>
</ul>

<p>방명록 요구사항 4/6</p>

<ul>
  <li>입력한 한 건의 정보가 보여진다. (캡쳐 화면의 이미지는 입력된 방명록을 삭제한 이후에 입력해서 ID가 15가 되었다.)</li>
  <li>방명록 내용과 폼 사이의 숫자는 방명록 페이지 링크. 방명록 5건당 1페이지로 설정한다.</li>
</ul>

<p>방명록 요구사항 5/6</p>

<ul>
  <li>방명록이 6건 입력되자 아래 페이지 수가 2건 보여진다. 1페이지를 누르면 /guestbook/list?start=0을 요청하고, 2페이지를 누르면 /guestbook/list?start=5를 요청하게 된다.</li>
  <li>/guestbook/list는 /guestbook/list?start=0과 결과가 같다.</li>
</ul>

<p>방명록 요구사항 6/6</p>

<ul>
  <li>방명록에 글을 쓰거나, 방명록의 글을 삭제할 때는 Log테이블에 클라이언트의 ip주소, 등록(삭제) 시간, 등록/삭제(method칼럼) 정보를 데이터베이스에 저장한다.</li>
  <li>사용하는 테이블은 log이다.</li>
  <li>id는 자동으로 입력되도록 한다.</li>
</ul>

<p>방명록 클래스 다이어그램</p>

<ul>
  <li>프레젠테이션(웹) 레이어 설정 파일 : web.xml, WebMvcContextConfiguration.java</li>
  <li>
    <p>서비스(비지니스), 레파지토리 레이어 설정 파일 : ApplicationConfig.java, DbConfig.java</p>
  </li>
  <li>
<img src="/img/layerd1.png" alt="">
    <ul>
      <li>설정 파일이 위의 그림처럼 4개가 필요하다.</li>
      <li>web.xml에서는 두 개의 자바 config 파일에 대해 설정한다. 하나는 DispatcherServlet이 읽어들이는 WebMvcContextConfiguration이고, 또 하나는 ApplicationContextListener가 읽어들일 ApplicationConfig 파일이다. ApplicationConfig 파일에서는 DBconfig를 import하게 된다.</li>
    </ul>
  </li>
  <li>
<img src="/img/layerd2.png" alt="">
    <ul>
      <li>방명록 앱 어플리케이션에서 url 요청을 처리하는 핸들러인 GuestbookController.</li>
      <li>GuestbookController는 비즈니스 로직을 갖고 있는 서비스 객체를 사용하게 된다.</li>
      <li>해당 서비스 객체는 GuestbookService라는 인터페이스와 GuestbookServiceImpl이라고 하는 실제 구현 클래스로 구성을 하게 될 것이다.</li>
      <li>GuestbookServiceImpl에서는 logDao와 GuestbookDao를 이용해서 비즈니스 로직을 수행한다. 비즈니스 로직은 하나의 트랜잭션 단위로 동작한다.</li>
      <li>LogDao는 저장만 하고 나머지 작업들은 수행하지 않는다. 그렇기 때문에 별도로 sql은 필요가 없다.</li>
      <li>GuestbookDao에서는 여러 개의 sql작업을 수행하기 때문에 이 sql들은 GuestbookDaoSqls 파일에서 한 번에 관리한다.</li>
      <li>LogDao와 GuestbookDao가 사용할 dto가 필요하다.</li>
      <li>뷰의 역할을 수행하기 위해서 list.jsp를 작성한다.</li>
      <li>index.jsp는 리다이렉트하는 코드만 나오게 된다.</li>
    </ul>
  </li>
</ul>

<p><strong>실습코드</strong></p>

<p>WebMvcContextConfiguration.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.DefaultServletHandlerConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.ViewControllerRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.view.InternalResourceViewResolver</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableWebMvc</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="o">{</span> <span class="s">"kr.or.connect.guestbook.controller"</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebMvcContextConfiguration</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span><span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addResourceHandlers</span><span class="o">(</span><span class="n">ResourceHandlerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addResourceHandler</span><span class="o">(</span><span class="s">"/css/**"</span><span class="o">).</span><span class="na">addResourceLocations</span><span class="o">(</span><span class="s">"/css/"</span><span class="o">).</span><span class="na">setCachePeriod</span><span class="o">(</span><span class="mi">31556926</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addResourceHandler</span><span class="o">(</span><span class="s">"/img/**"</span><span class="o">).</span><span class="na">addResourceLocations</span><span class="o">(</span><span class="s">"/img/"</span><span class="o">).</span><span class="na">setCachePeriod</span><span class="o">(</span><span class="mi">31556926</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addResourceHandler</span><span class="o">(</span><span class="s">"/js/**"</span><span class="o">).</span><span class="na">addResourceLocations</span><span class="o">(</span><span class="s">"/js/"</span><span class="o">).</span><span class="na">setCachePeriod</span><span class="o">(</span><span class="mi">31556926</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="c1">// default servlet handler를 사용하게 합니다.</span>
    <span class="c1">// 맵핑 정보가 없는 url 요청이 들어 왔을 때, 맵핑정보가 없는 url 요청은 Spring의 DefaultServletHttpRequestHandler가 처리하도록 해주게 하는 것.</span>
    <span class="c1">// 맵핑 정보가 없는 url 요청이 들어왔을 때 WAS의 default servlet이 static한 자원을 읽어서 보여줄 수 있게끔 해준다.</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureDefaultServletHandling</span><span class="o">(</span><span class="n">DefaultServletHandlerConfigurer</span> <span class="n">configurer</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">configurer</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
    <span class="o">}</span>
   
    <span class="c1">//특정 url에 대한 처리를 컨트롤러 클래스를 작성하지 않고 맵핑할 수 있도록 해준다.</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="kd">final</span> <span class="n">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
    		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"addViewControllers가 호출됩니다. "</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">"/"</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">"index"</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="c1">//viewResolver가 알맞는 view를 찾게 해준다.</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">InternalResourceViewResolver</span> <span class="nf">getInternalResourceViewResolver</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">InternalResourceViewResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InternalResourceViewResolver</span><span class="o">();</span>
        <span class="n">resolver</span><span class="o">.</span><span class="na">setPrefix</span><span class="o">(</span><span class="s">"/WEB-INF/views/"</span><span class="o">);</span>
        <span class="n">resolver</span><span class="o">.</span><span class="na">setSuffix</span><span class="o">(</span><span class="s">".jsp"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">resolver</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>DBConfig.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.dbcp2.BasicDataSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.PlatformTransactionManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.EnableTransactionManagement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.TransactionManagementConfigurer</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="c1">//트랜잭션과 관련된 설정을 자동으로 해준다. 단, 사용자 간의 트랜잭션 처리를 위한 PlatformTransactionManager를 설정하기 위해서는 TransactionManagementConfigurer를 구현하고 annotationDrivenTransactionManager를 override해야한다. 해당 메서드에서 트랜잭션을 처리할 PlatformTransactionManager 객체를 반환하게 하면 된다. annotationDrivenTransactionManager에서 호출하는 transactionManager() 메서드는 리턴 타입이 PlatformTransactionManager인 것을 볼 수 있다.</span>
<span class="nd">@EnableTransactionManagement</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DBConfig</span> <span class="kd">implements</span> <span class="n">TransactionManagementConfigurer</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">driverClassName</span> <span class="o">=</span> <span class="s">"com.mysql.jdbc.Driver"</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:mysql://localhost:3306/connectdb?useUnicode=true&amp;characterEncoding=utf8"</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="s">"connectuser"</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">"connect123!@#"</span><span class="o">;</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">BasicDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicDataSource</span><span class="o">();</span>
		<span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClassName</span><span class="o">(</span><span class="n">driverClassName</span><span class="o">);</span>
		<span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
		<span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
		<span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">annotationDrivenTransactionManager</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="nf">transactionManger</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="n">PlatformTransactionManager</span> <span class="nf">transactionManger</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">DataSourceTransactionManager</span><span class="o">(</span><span class="n">dataSource</span><span class="o">());</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>ApplicationConfig.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Import</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="c1">//dao나 service에 구현되어 있는 컴포넌트들을 읽어오면 되므로 basePackages에다가 각각의 패키지를 지정하고 있는 것을 볼 수 있다.</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="o">{</span> <span class="s">"kr.or.connect.guestbook.dao"</span><span class="o">,</span>  <span class="s">"kr.or.connect.guestbook.service"</span><span class="o">})</span>
<span class="c1">//dao, service에서 DB에 관련된 작업을 수행할 때 필요한 DB설정 파일 import</span>
<span class="nd">@Import</span><span class="o">({</span> <span class="n">DBConfig</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationConfig</span> <span class="o">{</span>

<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>web.xml</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td>
<td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;web-app&gt;</span>

	<span class="nt">&lt;display-name&gt;</span>Spring JavaConfig Sample<span class="nt">&lt;/display-name&gt;</span>
	<span class="nt">&lt;context-param&gt;</span>
		<span class="nt">&lt;param-name&gt;</span>contextClass<span class="nt">&lt;/param-name&gt;</span>
		<span class="nt">&lt;param-value&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext
		<span class="nt">&lt;/param-value&gt;</span>
	<span class="nt">&lt;/context-param&gt;</span>
	<span class="nt">&lt;context-param&gt;</span>
		<span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
		<span class="nt">&lt;param-value&gt;</span>kr.or.connect.guestbook.config.ApplicationConfig
		<span class="nt">&lt;/param-value&gt;</span>
	<span class="nt">&lt;/context-param&gt;</span>
    <span class="c">&lt;!-- 레이어드 아키텍쳐에 따라 설정 파일이 나눠진 상태이다. ApplicationConfig, DBConfig를 읽게 하기 위해 필요한 부분이다. listener는 어떤 특정한 이벤트가 일어났을 때 동작하는 것이다. ContextLoaderListener는 run on server를 하면 서버 실행을 위해 로딩이 되는데, 이처럼 Context가 로딩되는 이벤트가 발생했을 때 수행되는 리스너이다. 즉, Context가 로딩되면 ContextLoaderListener 클래스를 실행한다. 이 때, context-param에 등록되어 있는 부분들을 참고하게 된다. 따라서 ApplicationConfig와 DBConfig를 context-param이 등록해놓고 이벤트가 발생했을 때 리스터가 실행되면서 참고하게 된다.  --&gt;</span>
	<span class="nt">&lt;listener&gt;</span>
		<span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener
		<span class="nt">&lt;/listener-class&gt;</span>
	<span class="nt">&lt;/listener&gt;</span>

	<span class="nt">&lt;servlet&gt;</span>
        <span class="c">&lt;!-- 2. 받은 요청은 DispatcherServlet이 처리하게 하기위해 프론트 서블릿으로 등록한다. DispatcherServlet 클래스가 실행될 때 init-param으로 등록되어 있는 ApplicationConfig와 DBConfig를 가져다가 사용한다. --&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>mvc<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet
		<span class="nt">&lt;/servlet-class&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>contextClass<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext
			<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>kr.or.connect.guestbook.config.WebMvcContextConfiguration
			<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
	<span class="nt">&lt;/servlet&gt;</span>
    <span class="c">&lt;!-- 1. 모든 요청을 받는다. --&gt;</span>
	<span class="nt">&lt;servlet-mapping&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>mvc<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/servlet-mapping&gt;</span>

    <span class="c">&lt;!--filter는 요청이 수행되기 전, 응답이 나가기 전에 한 번씩 수행을 하게 되는 부분이다. spring이 제공하는 CharacterEncodingFilter를 등록해서 한글 인코딩 처리를 지원한다. 다른 값들은 다 정해져 있고, 우리가 지정할 수 있는 부분은 param-value의 인코딩 형식 뿐이다.--&gt;</span>
	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>encodingFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter
		<span class="nt">&lt;/filter-class&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>
	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>encodingFilter<span class="nt">&lt;/filter-name&gt;</span>
        <span class="c">&lt;!--url pattern은 이 filter를 어디까지 적용하게 할 건지에 대한 부분이다. 모든 요청에 대해 지정을 하고 싶었기 때문에 /*로 지정을 한 것. 특정한 URL에만 지정할 수도 있다.--&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>index.jsp</p>

<pre><code class="language-jsp">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%&gt;
&lt;% 
	//list라는 요청으로 redirect한다.
	response.sendRedirect("list");
%&gt;
</code></pre>

<p><strong>실습코드</strong></p>

<p>Guestbook.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Guestbook</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">Date</span> <span class="n">regdate</span><span class="o">;</span>
	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getContent</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">content</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContent</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Date</span> <span class="nf">getRegdate</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">regdate</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRegdate</span><span class="o">(</span><span class="n">Date</span> <span class="n">regdate</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">regdate</span> <span class="o">=</span> <span class="n">regdate</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"Guestbook [id="</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">", name="</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">", content="</span> <span class="o">+</span> <span class="n">content</span> <span class="o">+</span> <span class="s">", regdate="</span> <span class="o">+</span> <span class="n">regdate</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>Log.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Log</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">ip</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">method</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">Date</span> <span class="n">regdate</span><span class="o">;</span>
	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getIp</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIp</span><span class="o">(</span><span class="n">String</span> <span class="n">ip</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getMethod</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">method</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMethod</span><span class="o">(</span><span class="n">String</span> <span class="n">method</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Date</span> <span class="nf">getRegdate</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">regdate</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRegdate</span><span class="o">(</span><span class="n">Date</span> <span class="n">regdate</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">regdate</span> <span class="o">=</span> <span class="n">regdate</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">"Log [id="</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">", ip="</span> <span class="o">+</span> <span class="n">ip</span> <span class="o">+</span> <span class="s">", method="</span> <span class="o">+</span> <span class="n">method</span> <span class="o">+</span> <span class="s">", regdate="</span> <span class="o">+</span> <span class="n">regdate</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>LogDao.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.SqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.simple.SimpleJdbcInsert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.dto.Log</span><span class="o">;</span>

<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogDao</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="n">NamedParameterJdbcTemplate</span> <span class="n">jdbc</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">SimpleJdbcInsert</span> <span class="n">insertAction</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">LogDao</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jdbc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NamedParameterJdbcTemplate</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">insertAction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleJdbcInsert</span><span class="o">(</span><span class="n">dataSource</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withTableName</span><span class="o">(</span><span class="s">"log"</span><span class="o">)</span>
	            <span class="c1">//id컬럼 값이 자동으로 입력되도록 하는 부분</span>
                <span class="o">.</span><span class="na">usingGeneratedKeyColumns</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span>
    <span class="o">}</span>

	<span class="kd">public</span> <span class="n">Long</span> <span class="nf">insert</span><span class="o">(</span><span class="n">Log</span> <span class="n">log</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">SqlParameterSource</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BeanPropertySqlParameterSource</span><span class="o">(</span><span class="n">log</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">insertAction</span><span class="o">.</span><span class="na">executeAndReturnKey</span><span class="o">(</span><span class="n">params</span><span class="o">).</span><span class="na">longValue</span><span class="o">();</span> <span class="c1">//executeAndReutrnKey() 메서드를 통해 insert문은 내부적으로 생성해서 실행을 하고 자동으로 생성된 id 값을 리턴하게 된다. 이 때 리턴 된 id 값을 사용할 수도 있다.</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>GuestbookDaoSqls.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GuestbookDaoSqls</span> <span class="o">{</span>
    <span class="c1">//mysql query 중에 limit를 이용하면 시작 값, 끝날 때의 값 등을 설정해서 특정한 부분만 select해오는 쿼리를 실행할 수 있다.</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">SELECT_PAGING</span> <span class="o">=</span> <span class="s">"SELECT id, name, content, regdate FROM guestbook ORDER BY id DESC limit :start, :limit"</span><span class="o">;</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DELETE_BY_ID</span> <span class="o">=</span> <span class="s">"DELETE FROM guestbook WHERE id = :id"</span><span class="o">;</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">SELECT_COUNT</span> <span class="o">=</span> <span class="s">"SELECT count(*) FROM guestbook"</span><span class="o">;</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>GuestbookDao.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.BeanPropertyRowMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.RowMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.namedparam.SqlParameterSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.jdbc.core.simple.SimpleJdbcInsert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.dto.Guestbook</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">GuestbookDaoSqls</span><span class="o">.*;</span>

<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GuestbookDao</span> <span class="o">{</span>
	 <span class="kd">private</span> <span class="n">NamedParameterJdbcTemplate</span> <span class="n">jdbc</span><span class="o">;</span>
	    <span class="kd">private</span> <span class="n">SimpleJdbcInsert</span> <span class="n">insertAction</span><span class="o">;</span>
	    <span class="kd">private</span> <span class="n">RowMapper</span><span class="o">&lt;</span><span class="n">Guestbook</span><span class="o">&gt;</span> <span class="n">rowMapper</span> <span class="o">=</span> <span class="n">BeanPropertyRowMapper</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">Guestbook</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

	    <span class="kd">public</span> <span class="nf">GuestbookDao</span><span class="o">(</span><span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
	        <span class="k">this</span><span class="o">.</span><span class="na">jdbc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NamedParameterJdbcTemplate</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
	        <span class="k">this</span><span class="o">.</span><span class="na">insertAction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleJdbcInsert</span><span class="o">(</span><span class="n">dataSource</span><span class="o">)</span>
	                <span class="o">.</span><span class="na">withTableName</span><span class="o">(</span><span class="s">"guestbook"</span><span class="o">)</span>
	                <span class="o">.</span><span class="na">usingGeneratedKeyColumns</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span>
	    <span class="o">}</span>
	    
	    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Guestbook</span><span class="o">&gt;</span> <span class="nf">selectAll</span><span class="o">(</span><span class="n">Integer</span> <span class="n">start</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">limit</span><span class="o">)</span> <span class="o">{</span>
	    		<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
	    		<span class="n">params</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"start"</span><span class="o">,</span> <span class="n">start</span><span class="o">);</span>
	    		<span class="n">params</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"limit"</span><span class="o">,</span> <span class="n">limit</span><span class="o">);</span>
	        <span class="k">return</span> <span class="n">jdbc</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">SELECT_PAGING</span><span class="o">,</span> <span class="n">params</span><span class="o">,</span> <span class="n">rowMapper</span><span class="o">);</span>
	    <span class="o">}</span>


		<span class="kd">public</span> <span class="n">Long</span> <span class="nf">insert</span><span class="o">(</span><span class="n">Guestbook</span> <span class="n">guestbook</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">SqlParameterSource</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BeanPropertySqlParameterSource</span><span class="o">(</span><span class="n">guestbook</span><span class="o">);</span>
			<span class="k">return</span> <span class="n">insertAction</span><span class="o">.</span><span class="na">executeAndReturnKey</span><span class="o">(</span><span class="n">params</span><span class="o">).</span><span class="na">longValue</span><span class="o">();</span>
		<span class="o">}</span>
		
		<span class="kd">public</span> <span class="kt">int</span> <span class="nf">deleteById</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">singletonMap</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
			<span class="k">return</span> <span class="n">jdbc</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">DELETE_BY_ID</span><span class="o">,</span> <span class="n">params</span><span class="o">);</span>
		<span class="o">}</span>
		
		<span class="kd">public</span> <span class="kt">int</span> <span class="nf">selectCount</span><span class="o">()</span> <span class="o">{</span>
			<span class="k">return</span> <span class="n">jdbc</span><span class="o">.</span><span class="na">queryForObject</span><span class="o">(</span><span class="n">SELECT_COUNT</span><span class="o">,</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyMap</span><span class="o">(),</span> <span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="o">}</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>GuestbookDaoTest.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.config.ApplicationConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.dto.Log</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GuestbookDaoTest</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">ApplicationContext</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> 
<span class="c1">//		GuestbookDao guestbookDao = ac.getBean(GuestbookDao.class);</span>
<span class="c1">//		</span>
<span class="c1">//		Guestbook guestbook = new Guestbook();</span>
<span class="c1">//		guestbook.setName("강경미");</span>
<span class="c1">//		guestbook.setContent("반갑습니다. 여러분.");</span>
<span class="c1">//		guestbook.setRegdate(new Date());</span>
<span class="c1">//		Long id = guestbookDao.insert(guestbook);</span>
<span class="c1">//		System.out.println("id : " + id);</span>
		
		<span class="n">LogDao</span> <span class="n">logDao</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">LogDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">Log</span> <span class="n">log</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Log</span><span class="o">();</span>
		<span class="n">log</span><span class="o">.</span><span class="na">setIp</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">);</span>
		<span class="n">log</span><span class="o">.</span><span class="na">setMethod</span><span class="o">(</span><span class="s">"insert"</span><span class="o">);</span>
		<span class="n">log</span><span class="o">.</span><span class="na">setRegdate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
		<span class="n">logDao</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">log</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p><strong>실습코드</strong></p>

<p>인터페이스가 들어갈 service 패키지와 이 service를 구현할 serviceImpl패키지를 만든다. 그리고 service안에 GuestbookService 인터페이스를 만들고, 어떤 비즈니스 메서드가 들어갈 지 생각해서 넣는다.</p>

<ul>
  <li>방명록 정보를 페이지 별로 읽어오기</li>
  <li>페이징 처리를 위해서 전체 건 수 구하기</li>
  <li>방명록 저장하기</li>
</ul>

<p>등을 생각해볼 수 있다.</p>

<p>GuestbookService.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.dto.Guestbook</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">GuestbookService</span> <span class="o">{</span>
    <span class="c1">//페이지 당 보여지는 방명록의 숫자 나중에 이 부분만 수정하면 페이지당 보여지는 방명록 숫자를 한 번에 수정할 수 있다.</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Integer</span> <span class="n">LIMIT</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>
    <span class="c1">//조회</span>
	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Guestbook</span><span class="o">&gt;</span> <span class="nf">getGuestbooks</span><span class="o">(</span><span class="n">Integer</span> <span class="n">start</span><span class="o">);</span>
    <span class="c1">//삭제 - ip는 LogDao를 통해 Log 테이블에 저장될 것이다.</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">deleteGuestbook</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">ip</span><span class="o">);</span>
    <span class="c1">//등록 - ip는 LogDao를 통해 Log 테이블에 저장될 것이다.</span>
	<span class="kd">public</span> <span class="n">Guestbook</span> <span class="nf">addGuestbook</span><span class="o">(</span><span class="n">Guestbook</span> <span class="n">guestbook</span><span class="o">,</span> <span class="n">String</span> <span class="n">ip</span><span class="o">);</span>
    <span class="c1">//개수 조회</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">();</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>GuestbookServiceImpl.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">service</span><span class="o">.</span><span class="na">impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.dao.GuestbookDao</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.dao.LogDao</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.dto.Guestbook</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.dto.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.service.GuestbookService</span><span class="o">;</span>

<span class="c1">//DAO는 @Repository라는 어노테이션을 붙여줬다면 서비스 쪽에다가는 @Service라는 어노테이션을 붙여주면 된다.</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GuestbookServiceImpl</span> <span class="kd">implements</span> <span class="n">GuestbookService</span><span class="o">{</span>
    
    <span class="c1">//자동으로 Bean을 등록해준다.</span>
	<span class="nd">@Autowired</span>
	<span class="n">GuestbookDao</span> <span class="n">guestbookDao</span><span class="o">;</span>
	
	<span class="nd">@Autowired</span>
	<span class="n">LogDao</span> <span class="n">logDao</span><span class="o">;</span>

	<span class="nd">@Override</span>
    <span class="c1">//읽기만 하는 메서드는 Transactional annotation을 붙여주면 내부적으로 readOnly라는 형태로 커넥션을 사용하게 된다.</span>
	<span class="nd">@Transactional</span>
    <span class="c1">//start부터 몇 개를 불러올지를 알아야하기 때문에 start를 인자로 받는다.</span>
	<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Guestbook</span><span class="o">&gt;</span> <span class="nf">getGuestbooks</span><span class="o">(</span><span class="n">Integer</span> <span class="n">start</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">Guestbook</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">guestbookDao</span><span class="o">.</span><span class="na">selectAll</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">GuestbookService</span><span class="o">.</span><span class="na">LIMIT</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">list</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
    <span class="c1">//readonly로 수행되면 안 되므로 false로 옵션 지정</span>
	<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">deleteGuestbook</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">ip</span><span class="o">)</span> <span class="o">{</span>
		<span class="kt">int</span> <span class="n">deleteCount</span> <span class="o">=</span> <span class="n">guestbookDao</span><span class="o">.</span><span class="na">deleteById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
		<span class="n">Log</span> <span class="n">log</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Log</span><span class="o">();</span>
		<span class="n">log</span><span class="o">.</span><span class="na">setIp</span><span class="o">(</span><span class="n">ip</span><span class="o">);</span>
		<span class="n">log</span><span class="o">.</span><span class="na">setMethod</span><span class="o">(</span><span class="s">"delete"</span><span class="o">);</span>
		<span class="n">log</span><span class="o">.</span><span class="na">setRegdate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
		<span class="n">logDao</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">log</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">deleteCount</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span>
    <span class="c1">//geustbook 정보는 앞에 컨트롤러 단에서 넘겨 줬을 것이다. 컨트롤러 단에서는 클라이언트한테 받아온 정보들을 담고 있었을 것이다.</span>
	<span class="kd">public</span> <span class="n">Guestbook</span> <span class="nf">addGuestbook</span><span class="o">(</span><span class="n">Guestbook</span> <span class="n">guestbook</span><span class="o">,</span> <span class="n">String</span> <span class="n">ip</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">guestbook</span><span class="o">.</span><span class="na">setRegdate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
        <span class="c1">//insert 메서드가 수행됐을 때 id값을 리턴한다고 했으므로 받아서 저장</span>
		<span class="n">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">guestbookDao</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">guestbook</span><span class="o">);</span>
		<span class="n">guestbook</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
		
<span class="c1">//      트랜잭션 확인을 위해 일부러 exception을 수행시켜보는 부분  </span>
<span class="c1">//		if(1 == 1)</span>
<span class="c1">//			throw new RuntimeException("test exception");</span>
<span class="c1">//			</span>
        <span class="c1">//로그 부분에서 에러가 났는데, 앞에 수행된 부분이 취소가 되었다. 이것이 바로 트랜잭션.</span>
		<span class="n">Log</span> <span class="n">log</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Log</span><span class="o">();</span>
		<span class="n">log</span><span class="o">.</span><span class="na">setIp</span><span class="o">(</span><span class="n">ip</span><span class="o">);</span>
		<span class="n">log</span><span class="o">.</span><span class="na">setMethod</span><span class="o">(</span><span class="s">"insert"</span><span class="o">);</span>
		<span class="n">log</span><span class="o">.</span><span class="na">setRegdate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
		<span class="n">logDao</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">log</span><span class="o">);</span>
		
		
		<span class="k">return</span> <span class="n">guestbook</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
    <span class="c1">//페이징 처리를 위해서 전체 방명록 수를 구하는 부분</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">guestbookDao</span><span class="o">.</span><span class="na">selectCount</span><span class="o">();</span>
	<span class="o">}</span>
	
	
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>GuestbookServiceTest.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">service</span><span class="o">.</span><span class="na">impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.config.ApplicationConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.dto.Guestbook</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.service.GuestbookService</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GuestbookServiceTest</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">ApplicationContext</span> <span class="n">ac</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">ApplicationConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> 
		<span class="n">GuestbookService</span> <span class="n">guestbookService</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">GuestbookService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		
		<span class="n">Guestbook</span> <span class="n">guestbook</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Guestbook</span><span class="o">();</span>
		<span class="n">guestbook</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"kang kyungmi22"</span><span class="o">);</span>
		<span class="n">guestbook</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="s">"반갑습니다. 여러분. 여러분이 재미있게 공부하고 계셨음 정말 좋겠네요^^22"</span><span class="o">);</span>
		<span class="n">guestbook</span><span class="o">.</span><span class="na">setRegdate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
		<span class="n">Guestbook</span> <span class="n">result</span> <span class="o">=</span> <span class="n">guestbookService</span><span class="o">.</span><span class="na">addGuestbook</span><span class="o">(</span><span class="n">guestbook</span><span class="o">,</span> <span class="s">"127.0.0.1"</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
		
	<span class="o">}</span>

<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type ‘kr.or.connect.guestbook.serviceImpl.GuestbookServiceImpl’ available</p>

<p>위의 오류 해결</p>

<p>https://stackoverflow.com/questions/26095881/no-found-for-dependency-expected-at-least-1-bean-which-qualifies-as-autowire-ca</p>

<p>mysql syntax-highlighting</p>

<p>https://github.com/dbcli/mycli</p>

<p><strong>실습코드</strong></p>

<p>GuestbookController.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre></td>
<td class="rouge-code"><pre><span class="kn">package</span> <span class="n">kr</span><span class="o">.</span><span class="na">or</span><span class="o">.</span><span class="na">connect</span><span class="o">.</span><span class="na">guestbook</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.ModelMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.dto.Guestbook</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kr.or.connect.guestbook.service.GuestbookService</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GuestbookController</span> <span class="o">{</span>
    <span class="c1">//service를 이용하기 위해서 autowired선언</span>
	<span class="nd">@Autowired</span>
	<span class="n">GuestbookService</span> <span class="n">guestbookService</span><span class="o">;</span>
	
	<span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span><span class="o">=</span><span class="s">"/list"</span><span class="o">)</span>
    <span class="c1">//RequestParam으로 name이 start인 값을 받는데, 만약 start에 값이 없다면 기본 값을 0으로 주겠다 index가 0부터 시작하게 하기 위한 옵션.</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">list</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"start"</span><span class="o">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">false</span><span class="o">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="s">"0"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span>
					   <span class="n">ModelMap</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
		
		<span class="c1">// service로부터 start로 시작하는 방명록 목록 구해오기</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">Guestbook</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">guestbookService</span><span class="o">.</span><span class="na">getGuestbooks</span><span class="o">(</span><span class="n">start</span><span class="o">);</span>
		
		<span class="c1">// 전체 페이지수 구하기</span>
		<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="n">guestbookService</span><span class="o">.</span><span class="na">getCount</span><span class="o">();</span>
        <span class="c1">// 한 페이지당 보여줄 방명록 수</span>
		<span class="kt">int</span> <span class="n">pageCount</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="n">GuestbookService</span><span class="o">.</span><span class="na">LIMIT</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="n">count</span> <span class="o">%</span> <span class="n">GuestbookService</span><span class="o">.</span><span class="na">LIMIT</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
			<span class="n">pageCount</span><span class="o">++;</span>
		
		<span class="c1">// 페이지 수만큼 start의 값을 리스트로 저장</span>
		<span class="c1">// 예를 들면 페이지수가 3이면</span>
		<span class="c1">// 0, 5, 10 이렇게 저장된다.</span>
		<span class="c1">// list?start=0 , list?start=5, list?start=10 으로 링크가 걸린다.</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">pageStartList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pageCount</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
			<span class="n">pageStartList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">GuestbookService</span><span class="o">.</span><span class="na">LIMIT</span><span class="o">);</span>
		<span class="o">}</span>
		
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"list"</span><span class="o">,</span> <span class="n">list</span><span class="o">);</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"count"</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"pageStartList"</span><span class="o">,</span> <span class="n">pageStartList</span><span class="o">);</span>
		
		<span class="k">return</span> <span class="s">"list"</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="nd">@PostMapping</span><span class="o">(</span><span class="n">path</span><span class="o">=</span><span class="s">"/write"</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">write</span><span class="o">(</span><span class="nd">@ModelAttribute</span> <span class="n">Guestbook</span> <span class="n">guestbook</span><span class="o">,</span>
						<span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">String</span> <span class="n">clientIp</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"clientIp : "</span> <span class="o">+</span> <span class="n">clientIp</span><span class="o">);</span>
		<span class="n">guestbookService</span><span class="o">.</span><span class="na">addGuestbook</span><span class="o">(</span><span class="n">guestbook</span><span class="o">,</span> <span class="n">clientIp</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"redirect:list"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</pre></td>
</tr></tbody></table></code></pre></div></div>

<p>list.jsp</p>

<pre><code class="language-jsp">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%&gt;
&lt;!-- jstl 사용을 위한 부분 --&gt;
&lt;%@ taglib prefix="c" uri="https://java.sun.com/jsp/jstl/core"%&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "https://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;방명록 목록&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

	&lt;h1&gt;방명록&lt;/h1&gt;
	&lt;br&gt; 방명록 전체 수 : ${count }
	&lt;br&gt;
	&lt;br&gt;

	&lt;c:forEach items="${list}" var="guestbook"&gt;

${guestbook.id }&lt;br&gt;
${guestbook.name }&lt;br&gt;
${guestbook.content }&lt;br&gt;
${guestbook.regdate }&lt;br&gt;

	&lt;/c:forEach&gt;
	&lt;br&gt;

	&lt;c:forEach items="${pageStartList}" var="pageIndex" varStatus="status"&gt;
		&lt;a href="list?start=${pageIndex}"&gt;${status.index +1 }&lt;/a&gt;&amp;nbsp; &amp;nbsp;
&lt;/c:forEach&gt;

	&lt;br&gt;
	&lt;br&gt;
	&lt;form method="post" action="write"&gt;
		name : &lt;input type="text" name="name"&gt;&lt;br&gt;
		&lt;textarea name="content" cols="60" rows="6"&gt;&lt;/textarea&gt;
		&lt;br&gt; &lt;input type="submit" value="등록"&gt;
	&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<hr>

<p><strong>생각해보기</strong></p>

<ol>
  <li>레이어 별로 개발을 진행할 때, 각 레이어별로 잘 동작하는지 확인하는 것은 매우 중요합니다. 어떤 특정 레이어가 올바르게 동작하지 않는다면 웹 어플리케이션은 제대로 동작하지 않을 것입니다. 어느 특정 레이어가 문제가 있는지 알려면, 각 레이어별로 테스트가 필요합니다. 자바에서 테스트 코드를 좀 더 효과적으로 작성할 수 있는 방법에 대해 알아보세요.</li>
</ol>

<hr>

<p><strong>참고 자료</strong></p>

<ul>
  <li>
    <p><strong>[참고링크] Web on Servlet Stack</strong><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html</a></p>
  </li>
  <li>
    <p><strong>[참고링크] Serving Web Content with Spring MVC</strong><a href="https://spring.io/guides/gs/serving-web-content/">https://spring.io/guides/gs/serving-web-content/</a></p>
  </li>
  <li>
    <p><strong>[참고링크] Spring MVC Tutorial</strong><a href="https://www.javatpoint.com/spring-3-mvc-tutorial">https://www.javatpoint.com/spring-3-mvc-tutorial</a></p>
  </li>
</ul>

  </article>
</div>

<!-- <div class="share-buttons">
  <h6>Share on: </h6>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/spring/2018/08/25/Layered-Architecture-%E1%84%89%E1%85%B5%E1%86%AF%E1%84%89%E1%85%B3%E1%86%B8.html" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/spring/2018/08/25/Layered-Architecture-%E1%84%89%E1%85%B5%E1%86%AF%E1%84%89%E1%85%B3%E1%86%B8.html" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=http://localhost:4000/spring/2018/08/25/Layered-Architecture-%E1%84%89%E1%85%B5%E1%86%AF%E1%84%89%E1%85%B3%E1%86%B8.html" class="google-plus btn" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
    <li>
      <a href="https://news.ycombinator.com/submitlink?u=http://localhost:4000/spring/2018/08/25/Layered-Architecture-%E1%84%89%E1%85%B5%E1%86%AF%E1%84%89%E1%85%B3%E1%86%B8.html" class="hacker-news btn" title="Share on Hacker News"><i class="fa fa-hacker-news"></i><span> Hacker News</span></a>
    </li>
    <li>
      <a href="https://www.reddit.com/submit?url=http://localhost:4000/spring/2018/08/25/Layered-Architecture-%E1%84%89%E1%85%B5%E1%86%AF%E1%84%89%E1%85%B3%E1%86%B8.html" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
    </li>
  </ul>
</div> -->


<div id="disqus_thread"></div>
</div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://https-youduk-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>


        <footer>
  © 2018 Ducku Salon. Powered by <a href="https://jekyllrb.com/">Jekyll</a>, <a href="https://github.com/renyuanz/leonids/">customized with leonids theme</a> <i class="fa fa-heart heart-icon"></i>
</footer>

<!-- Channel Plugin Scripts -->
<script>
  ;window.channelPluginSettings = {
    "pluginKey": "9de17a11-abe2-455f-a49c-1c7da4fa312c"
  };
  (function() {
    var w = window;
    if (w.ChannelIO) {
      return (window.console.error || window.console.log || function(){})('ChannelIO script included twice.');
    }
    var d = window.document;
    var ch = function() {
      ch.c(arguments);
    };
    ch.q = [];
    ch.c = function(args) {
      ch.q.push(args);
    };
    w.ChannelIO = ch;
    function l() {
      if (w.ChannelIOInitialized) {
        return;
      }
      w.ChannelIOInitialized = true;
      var s = document.createElement('script');
      s.type = 'text/javascript';
      s.async = true;
      s.src = 'https://cdn.channel.io/plugin/ch-plugin-web.js';
      s.charset = 'UTF-8';
      var x = document.getElementsByTagName('script')[0];
      x.parentNode.insertBefore(s, x);
    }
    if (document.readyState === 'complete') {
      l();
    } else if (window.attachEvent) {
      window.attachEvent('onload', l);
    } else {
      window.addEventListener('DOMContentLoaded', l, false);
      window.addEventListener('load', l, false);
    }
  })();
</script>
<!-- End Channel Plugin -->        
      </div>
    </div>
  </div>
  <script id="dsq-count-scr" src="//https-youduk-github-io.disqus.com/count.js" async></script>
  <script type="text/javascript" src="http://localhost:4000/js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="http://localhost:4000/js/main.js"></script>


    
</body>

</html>
